<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:bcf="http://brzaskun.com/facelets" xmlns:pe="http://primefaces.org/ui/extensions">
    <p:outputPanel style="padding: 20px;height: 80%">
        <p:tabView id="akordeon">
            <p:tab title="lista podmiotów">
                <h:form id="formlista">
                    <p:growl life="3600"  id="msgzus" ><p:autoUpdate/></p:growl>
                    <p:panel header="Wykaz podmiotów" style="width: 100%;">
                        <p:dataTable lazy="false"  value="#{podmiotView.podmioty}"  var="item" paginatorAlwaysVisible="true" paginator="true" pageLinks="12" rows="20"
                                     selection="#{podmiotView.selected}" selectionMode="single" rowKey="#{item.id}" editable="true"
                                     rowIndexVar="row"  style="max-width: 1750px;" editMode="row"
                                     emptyMessage="Nie wprowadzono stawek" reflow="true">
                            <p:ajax event="rowSelect"  partialSubmit="true"/>
                            <p:ajax event="rowEdit" partialSubmit="true" listener="#{podmiotView.rowedit}"/>
                            <p:ajax event="rowEditCancel" partialSubmit="true"  listener="#{podmiotView.rowcancel}"/>

                            <f:facet name="header">
                                <h:outputText value="Lista wprowadzonych stawek - pełny ZUS"/>
                            </f:facet>
                            <p:column width="30">
                                <f:facet name="header">
                                    <h:outputText value="Id"/>
                                </f:facet>
                                <h:outputText value="#{row+1}"/>
                            </p:column>
                            <p:column filterBy="#{item.nip}" filterMatchMode="startsWith" filterable="true" sortBy="#{item.nip}">
                                <f:facet name="header">
                                    <h:outputText value="Nip"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.nip}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.nip}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column filterBy="#{item.pesel}" filterMatchMode="startsWith" filterable="true" >
                                <f:facet name="header">
                                    <h:outputText value="Pesel"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.pesel}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.pesel}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column filterBy="#{item.krs}" filterMatchMode="startsWith" filterable="true" >
                                <f:facet name="header">
                                    <h:outputText value="Krs"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.krs}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.krs}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column filterBy="#{item.regon}" filterMatchMode="startsWith" filterable="true" >
                                <f:facet name="header">
                                    <h:outputText value="Regon"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.regon}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.regon}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column  >
                            <p:column width="200" filterBy="#{item.nazwa}" filterMatchMode="startsWith" filterable="true" sortBy="#{item.nazwa}">
                                <f:facet name="header">
                                    <h:outputText value="Nazwa"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.nazwa}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.nazwa}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column filterBy="#{item.nazwisko}" filterMatchMode="startsWith" filterable="true" sortBy="#{item.nazwisko}" >
                                <f:facet name="header">
                                    <h:outputText value="Nazwisko"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.nazwisko}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.nazwisko}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Imie"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.imie}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.imie}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column filterBy="#{item.login}" filterMatchMode="startsWith" filterable="true" >
                                <f:facet name="header">
                                    <h:outputText value="Login"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.login}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.login}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column width="40">
                                <f:facet name="header">
                                    <h:outputText value="Pin"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.pin}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.pin}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column width="200">
                                <f:facet name="header">
                                    <h:outputText value="Email"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.email}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.email}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Telefon"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.telefon}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.telefon}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column width="30" filterBy="#{item.krajrezydencji}" filterMatchMode="startsWith" filterable="true" sortBy="#{item.krajrezydencji}" style="text-align: center;">
                                <f:facet name="header">
                                    <h:outputText value="Kraj"/>
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{item.krajrezydencji}"/></f:facet>
                                    <f:facet name="input"><p:inputText value="#{item.krajrezydencji}" style="width: 90%"/></f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column style="width:35px">
                                <p:rowEditor />
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </h:form>
            </p:tab>
            <p:tab title="dodaj nowy">
                <script>
                    window.onload = function () {
                        r('akordeon:formdodaj:panela').hide();
                        r('akordeon:formdodaj:buton').hide();
                    };
                </script>
                <h1><h:outputText value="Dodaj nowy podmiot"/></h1>
                <p:panelGrid layout="tabular" columns="2">
                    <h:form id="formbuton">
                        <p:commandButton value="osoba fizyczna"  actionListener="#{podmiotView.setOsobafizyczna(true)}" update="akordeon:formdodaj:panel" style="width: 120px;" onclick="r('akordeon:formdodaj:panela').show();r('akordeon:formdodaj:buton').show()"/>
                        <p:commandButton value="osoba prawna" actionListener="#{podmiotView.setOsobafizyczna(false)}" update="akordeon:formdodaj:panel" style="width: 120px;" onclick="r('akordeon:formdodaj:panela').show();r('akordeon:formdodaj:buton').show()"/>
                    </h:form>
                </p:panelGrid>
                <h:form id="formdodaj">
                    <p:panelGrid layout="tabular" columns="1" id="panel">
                        <p:panelGrid layout="tabular" columns="2" id="panela">
                            <p:outputLabel value="Nip:" for="nip" />
                            <p:inputText id="nip" value="#{podmiotView.nowy.nip}" title="Nip" >
                                <p:ajax event="blur"  partialSubmit="true" listener="#{podmiotView.pobierzdaneind}" update="@form"/>
                            </p:inputText>
                            <p:outputLabel value="Pesel:" for="pesel"   rendered="#{podmiotView.osobafizyczna eq true}"/>
                            <p:inputText id="pesel" value="#{podmiotView.nowy.pesel}" title="Pesel"  rendered="#{podmiotView.osobafizyczna eq true}">
                                <p:ajax event="blur" partialSubmit="true" listener="#{podmiotView.sprawdzpesel()}"/>
                            </p:inputText>
                            <p:outputLabel value="Data urodzenia:" for="ur"   rendered="#{podmiotView.osobafizyczna eq true}"/>
                            <p:inputText id="ur" value="#{podmiotView.nowy.dataurodzenia}" title="Pesel"  rendered="#{podmiotView.osobafizyczna eq true}" placeholder="____-__-__">
                            </p:inputText>
                            <p:outputLabel value="Krs:" for="krs"  rendered="#{podmiotView.osobafizyczna eq false}"/>
                            <p:inputText id="krs" value="#{podmiotView.nowy.krs}" title="Krs" rendered="#{podmiotView.osobafizyczna eq false}">
                                <p:ajax event="blur" partialSubmit="true" listener="#{podmiotView.sprawdzkrs()}"/>
                            </p:inputText>
                            <p:outputLabel value="Regon:" for="regon" />
                            <p:inputText id="regon" value="#{podmiotView.nowy.regon}" title="Regon" />
                            <p:outputLabel value="Nazwa:" for="nazwa"  rendered="#{podmiotView.osobafizyczna eq false}"/>
                            <p:inputText id="nazwa" value="#{podmiotView.nowy.nazwa}" title="Nazwa" size="100" rendered="#{podmiotView.osobafizyczna eq false}"/>
                            <p:outputLabel value="Nazwisko:" for="nazwisko"   rendered="#{podmiotView.osobafizyczna eq true}"/>
                            <p:inputText id="nazwisko" value="#{podmiotView.nowy.nazwisko}" title="Nazwisko"  rendered="#{podmiotView.osobafizyczna eq true}"/>
                            <p:outputLabel value="Imie:" for="imie"   rendered="#{podmiotView.osobafizyczna eq true}"/>
                            <p:inputText id="imie" value="#{podmiotView.nowy.imie}" title="Imie"  rendered="#{podmiotView.osobafizyczna eq true}"/>
                            <p:outputLabel value="Login:" for="login" />
                            <p:inputText id="login" value="#{podmiotView.nowy.login}" title="Login" />
                            <p:outputLabel value="Pin:" for="pin" />
                            <p:inputText id="pin" value="#{podmiotView.nowy.pin}" title="Pin" />
                            <p:outputLabel value="Email:" for="email" />
                            <p:inputText id="email" value="#{podmiotView.nowy.email}" title="Email" />
                            <p:outputLabel value="Telefon:" for="telefon" />
                            <p:inputText id="telefon" value="#{podmiotView.nowy.telefon}" title="Telefon" />
                            <p:outputLabel value="Krajrezydencji:" for="krajrezydencji" />
                            <p:inputText id="krajrezydencji" value="#{podmiotView.nowy.krajrezydencji}" title="Kraj rezydencji" />
                        </p:panelGrid>
                        <p:commandButton value="dodaj" id="buton" actionListener="#{podmiotView.dodajnowy()}" update="@(form)" style="width: 120px;"  onclick="r('akordeon:formdodaj:panela').hide();;r('akordeon:formdodaj:buton').hide()"/>
                    </p:panelGrid>
                </h:form>
            </p:tab>
            <p:tab title="Udziały">
                <h:form id="form9">
                    <p:panelGrid layout="tabular" columns="2">
                        <p:selectBooleanCheckbox value="#{podmiotView.tylkoaktywne}" itemLabel="pokaż tylko aktywnych" title="pokaż tylko aktywnych" valueChangeListener="#{podmiotView.pobierzliste}">
                            <p:ajax event="change" partialSubmit="true" update="akordeon:form9:form9tablica"/>
                        </p:selectBooleanCheckbox>
                        <p:selectBooleanCheckbox value="#{podmiotView.tylkoprawne}" itemLabel="pokaż tylko niefizyczne" title="pokaż tylko niefizyczne" valueChangeListener="#{podmiotView.pobierzliste1}">
                            <p:ajax event="change" partialSubmit="true" update="akordeon:form9:form9tablica"/>
                        </p:selectBooleanCheckbox>
                    </p:panelGrid>
                    <p:dataTable lazy="false"  value="#{podmiotView.podatnikUdzialy}"  var="loop" rowKey="#{loop.id}"  id="form9tablica" 
                                 editable="true" style="width:1700px;height: 700px;overflow-y: scroll;" sortBy="#{loop.podatnikObj.printnazwa}" filteredValue="#{podmiotView.podatnikUdzialyFilter}">
                        <p:ajax event="rowEdit"  />
                        <p:column headerText="nazwa" style="text-align: left;" width="250" sortBy="#{loop.podatnikObj.printnazwa}" filterBy="#{loop.podatnikObj.printnazwa}" filterMatchMode="contains">
                            <h:outputText value="#{loop.podatnikObj.printnazwa}" />
                        </p:column>
                        <p:column headerText="księgowa" style="text-align: left;" width="100" sortBy="#{loop.podatnikObj.ksiegowa.imieNazwisko}" filterBy="#{loop.podatnikObj.ksiegowa.imieNazwisko}" filterMatchMode="contains">
                            <h:outputText value="#{loop.podatnikObj.ksiegowa.imieNazwisko}" />
                        </p:column>
                        <p:column headerText="fp" style="text-align: center;" width="30" sortBy="#{loop.podatnikObj.gussymbol}" filterBy="#{loop.podatnikObj.gussymbol}" filterMatchMode="startsWith">
                            <h:outputText value="#{loop.podatnikObj.gussymbol}" />
                        </p:column>
                        <p:column headerText="podmiot nazwa" style="text-align: left;" width="250">
                            <h:outputText value="#{loop.podmiot.nazwa}" />
                        </p:column>
                        <p:column headerText="podmiot nazwisko i imie" style="text-align: left;" width="150">
                            <h:outputText value="#{loop.podmiot.nazwisko}"/>
                            <h:outputText value=" "/>
                            <h:outputText value="#{loop.podmiot.imie}"/>
                        </p:column>
                        <p:column headerText="nazwisko i imie" width="200">
                            <h:outputText value="#{loop.nazwiskoimie}" />
                        </p:column>
                        <p:column headerText="data od" width="90">
                            <h:outputText value="#{loop.datarozpoczecia}" />
                        </p:column>
                        <p:column headerText="data do" width="90">
                            <h:outputText value="#{loop.datazakonczenia}"/>
                        </p:column>
                        <p:column headerText="nip" width="100" filterBy="#{loop.nip}" filterMatchMode="startsWith">
                            <h:outputText value="#{loop.nip}" />
                        </p:column>
                        <p:column headerText="pesel" width="100">
                            <h:outputText value="#{loop.pesel}" />
                        </p:column>
                        <p:column headerText="udział" style="text-align: center;" width="30">
                            <h:outputText value="#{loop.udzial}" />
                        </p:column>
                        <p:column headerText="udział" style="text-align: center;" width="30">
                            <p:commandButton icon="pi pi-book" actionListener="#{podmiotView.nowypodmiot(loop)}" update="akordeon:formdodaj" onclick="r('akordeon:formdodaj:panela').show();r('akordeon:formdodaj:buton').show()"/>
                        </p:column>
                        <!--                    <p:column headerText="liczba udz." width="30">
                                                <h:outputText value="#{loop.liczbaudzialow}" />
                                            </p:column>
                                            <p:column headerText="wartość nom."  width="70">
                                                <bcf:outputpl value="#{loop.wartoscnominalna}" />
                                            </p:column>-->
                    </p:dataTable>
                </h:form>
            </p:tab>
            <p:tab title="Podmioty">
                <h:form id="form10">
                    <p:panelGrid layout="tabular" columns="2">
                     <p:selectBooleanCheckbox value="#{podmiotView.tylkofizyczne}" itemLabel="pokaż tylko fizyczne" title="pokaż tylko fizyczne" >
                         <p:ajax event="change" partialSubmit="true" update="akordeon:form10" listener="#{podmiotView.pobierzpodmioty}"/>
                    </p:selectBooleanCheckbox>
                    <p:selectBooleanCheckbox value="#{podmiotView.tylkoprawne}" itemLabel="pokaż tylko niefizyczne" title="pokaż tylko niefizyczne">
                        <p:ajax event="change" partialSubmit="true" update="akordeon:form10" listener="#{podmiotView.pobierzpodmioty}"/>
                    </p:selectBooleanCheckbox>
                </p:panelGrid>
                    <p:dataTable lazy="false"  value="#{podmiotView.podmioty}"  var="loop11" rowKey="#{loop11.id}"  id="form9tablica"
                                 editable="true" style="width:1300px;" sortBy="#{loop11.nazwanazwisko}">
                        <p:ajax event="rowEdit"  />
                        <p:column width="10">
                            <p:rowToggler rendered="#{loop11.podatnikudzialy ne null and loop11.podatnikudzialy.size() gt 0}"/>
                        </p:column>
                        <p:column headerText="nazwa" style="text-align: left;" width="250" sortBy="#{loop11.nazwanazwisko}" filterBy="#{loop11.nazwanazwisko}" filterMatchMode="contains">
                            <h:outputText value="#{loop11.nazwanazwisko}" />
                        </p:column>
                        <p:column headerText="aktywny" width="30" style="text-align: center;">
                            <h:outputText value="&#x2713;" rendered="#{loop11.aktywny}" />
                        </p:column>
                        <p:column headerText="akt. dla zus" width="30" style="text-align: center;">
                            <h:outputText value="&#x2713;" rendered="#{loop11.aktywnydlazus}"/>
                        </p:column>
                        <p:column headerText="nip" width="100" filterBy="#{loop11.email}" filterMatchMode="startsWith">
                            <h:outputText value="#{loop11.email}" />
                        </p:column>
                        <p:column headerText="pesel" width="100">
                            <h:outputText value="#{loop11.telefon}" />
                        </p:column>
                        <p:rowExpansion>
                            <p:column id="udziały" headerText="udziały wykaz" width="500" resizable="true">  
                                <p:dataTable lazy="false"  var="subwpis" value="#{loop11.podatnikudzialy}" emptyMessage="brak udziałów!"  resizableColumns="true" style="width: 50%;">
                                    <p:column id="SubColumn1" headerText="nazwa">  
                                        <h:outputText value="#{subwpis.podatnikObj.printnazwa}" />
                                    </p:column>
                                    <p:column id="SubColumn1a"  headerText="nip">  
                                        <h:outputText value="#{subwpis.podatnikObj.nip}">
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="udział" style="text-align: center;" width="30">
                                        <h:outputText value="#{subwpis.udzial}" />
                                    </p:column>
                                    <p:column headerText="PIT" style="text-align: center;" width="30">
                                        <p:selectBooleanCheckbox value="#{subwpis.pit}" >
                                            <p:ajax event="change" partialSubmit="true" listener="#{podmiotView.editudzial(subwpis)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>
                                </p:dataTable>
                            </p:column>
                        </p:rowExpansion>
                    </p:dataTable>
                </h:form>
            </p:tab>
        </p:tabView>
    </p:outputPanel>    
</ui:composition>

